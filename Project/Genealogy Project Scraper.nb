(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[      9413,        240]
NotebookOptionsPosition[      8574,        214]
NotebookOutlinePosition[      8917,        229]
CellTagsIndexPosition[      8874,        226]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"RunCommand", "[", "cmd_", "]"}], ":=", 
  RowBox[{"StringJoin", "@", 
   RowBox[{"Riffle", "[", 
    RowBox[{
     RowBox[{"ReadList", "[", 
      RowBox[{
       RowBox[{"\"\<!\>\"", "<>", "cmd"}], ",", "\"\<String\>\""}], "]"}], 
     ",", "\"\<\\n\>\""}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.707689090468658*^9, 
  3.7076891728419266`*^9}},ExpressionUUID->"bc2effe6-8122-4876-aa7e-\
78db0ae7c232"],

Cell[BoxData[
 RowBox[{
  RowBox[{"streams", "=", "50"}], ";"}]], "Input",
 CellChangeTimes->{{3.707686757376783*^9, 3.7076867594166946`*^9}, {
  3.7076868460843816`*^9, 3.707686846937724*^9}, {3.707687946445088*^9, 
  3.7076879465968065`*^9}, {3.707687998414706*^9, 3.707687998515005*^9}, {
  3.707689737592306*^9, 3.7076897391927557`*^9}, {3.7076900635501833`*^9, 
  3.7076900674354696`*^9}, {3.7076902946608095`*^9, 
  3.707690294976294*^9}},ExpressionUUID->"59f2fb5f-7cdf-424d-9bbd-\
86865f9c579b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"startDownload", "[", "ids_List", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{"\"\<c:\\\\curl\\\\run.bat\>\"", ",", 
      RowBox[{"Riffle", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{"id", ",", 
           RowBox[{
           "\"\<START /B c:\\\\curl\\\\curl.exe -o \
c:\\\\curl\\\\mathGenealogy\\\\\>\"", "<>", 
            RowBox[{"ToString", "[", "id", "]"}], "<>", 
            "\"\< https://www.genealogy.math.ndsu.nodak.edu/id.php?id=\>\"", "<>", 
            RowBox[{"ToString", "[", "id", "]"}]}]}], "]"}], "/@", "ids"}], 
        ",", "\"\<\\r\\n\>\""}], "]"}], ",", "\"\<Text\>\""}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Quiet", "[", 
     RowBox[{"ReadList", "[", "\"\<!c:\\\\curl\\\\run.bat\>\"", "]"}], "]"}], 
    ";"}], "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.7076885722657666`*^9, 3.7076886794137974`*^9}, {
  3.707688862300248*^9, 3.707688947623554*^9}, {3.707688989008237*^9, 
  3.707688993456784*^9}, {3.707689038569578*^9, 
  3.707689049725298*^9}},ExpressionUUID->"3b05dc37-c574-45bd-98b7-\
be03a11765c7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"toDownloads", "=", 
   RowBox[{"Range", "[", 
    RowBox[{"22002", ",", 
     RowBox[{"22002", "+", "500"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"initialLength", "=", 
   RowBox[{"Length", "@", "toDownloads"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7076869246923018`*^9, 3.707686964721735*^9}, {
  3.707687018744553*^9, 3.707687030140747*^9}, {3.707689752112176*^9, 
  3.7076897612294016`*^9}, {3.7076900746450853`*^9, 
  3.707690075698639*^9}},ExpressionUUID->"7cc250ce-29bd-471c-bf5c-\
f1f1c48226fa"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"startTime", "=", "Now"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"currentlyRunning", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PrintTemporary", "[", 
   RowBox[{"Dynamic", "[", 
    RowBox[{"status", "=", "\[IndentingNewLine]", 
     RowBox[{"Column", "[", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Row", "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{"1", "-", 
             RowBox[{
              RowBox[{"Length", "[", "toDownloads", "]"}], "/", 
              "initialLength"}]}], "]"}], ",", 
           RowBox[{"Length", "[", "toDownloads", "]"}]}], "}"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<Time passed: \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"Round", "[", 
           RowBox[{"Now", "-", "startTime"}], "]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<Estimated time left: \>\"", "<>", 
         RowBox[{"ToString", "@", 
          RowBox[{"Round", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Now", "-", "startTime"}], ")"}], "/", 
             RowBox[{"(", 
              RowBox[{"initialLength", "-", 
               RowBox[{"Length", "[", "toDownloads", "]"}], "+", "0.01"}], 
              ")"}]}], "*", 
            RowBox[{"Length", "[", "toDownloads", "]"}]}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<Processes: \>\"", "<>", 
         RowBox[{"ToString", "[", "currentlyRunning", "]"}]}]}], 
       "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AbsoluteTiming", "[", 
   RowBox[{
    RowBox[{"While", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "@", "toDownloads"}], ">", "0"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"currentlyRunning", "=", 
        RowBox[{"StringCount", "[", 
         RowBox[{
          RowBox[{"RunCommand", "[", "\"\<tasklist /FO CSV\>\"", "]"}], ",", 
          "\"\<curl.exe\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"streams", "-", "currentlyRunning"}], ">", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"toRun", "=", 
              RowBox[{"Min", "[", 
               RowBox[{
                RowBox[{"Length", "[", "toDownloads", "]"}], ",", 
                RowBox[{"streams", "-", "currentlyRunning"}]}], "]"}]}], 
             "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"PrintTemporary", "[", 
               RowBox[{"\"\<currentlyRunning=\>\"", "<>", 
                RowBox[{"ToString", "@", "currentlyRunning"}], "<>", 
                "\"\<; starting \>\"", "<>", 
                RowBox[{"ToString", "@", 
                 RowBox[{"(", "toRun", ")"}]}]}], "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"startDownload", "[", 
              RowBox[{"toDownloads", "\[LeftDoubleBracket]", 
               RowBox[{";;", "toRun"}], "\[RightDoubleBracket]"}], "]"}], ";",
              "\[IndentingNewLine]", 
             RowBox[{"toDownloads", "=", 
              RowBox[{"Drop", "[", 
               RowBox[{"toDownloads", ",", "toRun"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"While", "[", 
     RowBox[{
      RowBox[{"currentlyRunning", ">", "0"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"currentlyRunning", "=", 
        RowBox[{"StringCount", "[", 
         RowBox[{
          RowBox[{"RunCommand", "[", "\"\<tasklist /FO CSV\>\"", "]"}], ",", 
          "\"\<curl.exe\>\""}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
     "]"}], ";"}], "\[IndentingNewLine]", "]"}], "\[LeftDoubleBracket]", "1", 
  "\[RightDoubleBracket]"}]}], "Input",
 CellChangeTimes->{{3.707686970937171*^9, 3.7076872054822373`*^9}, {
   3.7076872387782383`*^9, 3.7076872581043835`*^9}, 3.707687414829833*^9, {
   3.707687507364887*^9, 3.7076875581438923`*^9}, {3.7076878659311943`*^9, 
   3.7076879119661846`*^9}, {3.707688041458505*^9, 3.7076880473817797`*^9}, {
   3.707688125388051*^9, 3.707688151241155*^9}, {3.707689339977562*^9, 
   3.7076893964459743`*^9}, {3.7076895845783544`*^9, 3.707689586930191*^9}, {
   3.7076896276059656`*^9, 3.7076896381212564`*^9}, {3.707689669665141*^9, 
   3.7076896711208496`*^9}, {3.7076898851786118`*^9, 
   3.7076899288753705`*^9}, {3.7076902615295863`*^9, 
   3.7076903058562255`*^9}},ExpressionUUID->"8e2d6221-caf1-468a-8c5d-\
538bea520cc4"],

Cell[BoxData["178.95261251683354`"], "Output",
 CellChangeTimes->{3.7076896777050047`*^9, 3.7076897224582453`*^9, 
  3.7076898480532274`*^9, 3.707690025722627*^9, 3.707690232533687*^9, 
  3.707690487675636*^9},ExpressionUUID->"bff5a99c-8548-445d-84ee-\
42ccd8970060"]
}, Open  ]]
},
WindowSize->{796, 637},
WindowMargins->{{98, Automatic}, {Automatic, 23}},
FrontEndVersion->"11.1 for Microsoft Windows (64-bit) (March 13, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 442, 12, 30, "Input", "ExpressionUUID" -> \
"bc2effe6-8122-4876-aa7e-78db0ae7c232"],
Cell[1003, 34, 502, 9, 30, "Input", "ExpressionUUID" -> \
"59f2fb5f-7cdf-424d-9bbd-86865f9c579b"],
Cell[1508, 45, 1190, 27, 164, "Input", "ExpressionUUID" -> \
"3b05dc37-c574-45bd-98b7-be03a11765c7"],
Cell[2701, 74, 568, 13, 50, "Input", "ExpressionUUID" -> \
"7cc250ce-29bd-471c-bf5c-f1f1c48226fa"],
Cell[CellGroupData[{
Cell[3294, 91, 4994, 114, 544, "Input", "ExpressionUUID" -> \
"8e2d6221-caf1-468a-8c5d-538bea520cc4"],
Cell[8291, 207, 267, 4, 63, "Output", "ExpressionUUID" -> \
"bff5a99c-8548-445d-84ee-42ccd8970060"]
}, Open  ]]
}
]
*)

